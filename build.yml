name: JDump Build

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    permissions:
      contents: write
      pages: write
      deployments: write
      actions: write
      attestations: write
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Generate JDump Configuration
        run: |
          echo "// Generated by GitHub Actions" > script.js
          echo "name = 'CraftMaven;" >> script.js
          echo "filters = [\"MCP\", \"Forge\", \"Spigot\", \"APIs\"];" >> script.js
          echo "const artifacts = [];" >> script.js
          
          # Loop through artifacts in maven folder
          for dir in mcp-maven/*/*/*; do
            if [ -d "$dir" ]; then
              group_id=$(echo $dir | cut -d'/' -f2)
              artifact_id=$(echo $dir | cut -d'/' -f3)
              version=$(echo $dir | cut -d'/' -f4)
              
              echo "artifacts.push({" >> script.js
              echo "  name: '${artifact_id}'," >> script.js
              echo "  groupId: '${group_id}'," >> script.js
              echo "  latestVersion: '${version}'," >> script.js
              echo "  files: '$(ls $dir | wc -l)'," >> script.js
              echo "  description: 'Artifact from ${group_id}'," >> script.js
              echo "  lastUpdated: '$(date +"%Y-%m-%d")'," >> script.js
              echo "  versions: 1," >> script.js
              echo "  license: 'MIT'," >> script.js
              echo "  category: 'APIs'" >> script.js
              echo "});" >> script.js
            fi
          done

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: .
          branch: gh-pages
          clean: true